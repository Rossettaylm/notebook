#### 函数执行前会发生什么？

1. **函数调用前的准备工作**：
   - **参数传递**：将函数调用时传递的参数压栈或通过寄存器传递，以便在函数内部可以访问这些参数。
   - **返回地址保存**：在函数调用前，将函数调用的下一条指令地址（返回地址）压栈，用于在函数执行完后返回到正确的调用点。
   - **局部变量空间分配**：为函数内部定义的局部变量分配内存空间，以便在函数执行期间可以使用这些局部变量。
2. **函数执行**：函数体内的代码会被执行，处理传入的参数和局部变量的计算。
3. **函数调用后的清理工作**：
   - **返回值传递**：将函数返回值放在合适的寄存器或内存中，以便在函数返回后返回给调用者。
   - **恢复返回地址**：从栈中弹出之前保存的返回地址，以便返回到函数调用点继续执行。
   - **清理栈空间**：将栈上为局部变量分配的空间释放，恢复栈的状态，使其回到函数调用前的状态。
   - **处理异常**：如果在函数执行期间发生了异常，相应的异常处理机制会被触发，可能导致栈展开和资源释放。

这些操作保证了函数调用的正确性和一致性。在程序执行过程中，函数调用是通过栈来管理调用和返回的，这被称为函数调用栈（Function Call Stack）。每次函数调用时，相关的信息会被压栈，当函数返回时，这些信息会被出栈，以便继续执行之前的代码。

#### Linux进程加载动态库的时候会发生什么？

1. **动态库的查找和加载**：进程首先需要确定要加载的动态库的路径。通常，操作系统会在默认的动态库搜索路径（如 `/lib`、`/usr/lib`）下查找动态库，也可以通过设置环境变量 `LD_LIBRARY_PATH` 来指定其他搜索路径。一旦找到了要加载的动态库，操作系统会将其加载到进程的内存空间中。
2. **符号解析和重定位**：在动态库加载完成后，操作系统会对动态库进行符号解析和重定位。这是将动态库中的符号（函数和变量）与它们的地址进行关联的过程。符号解析将确定动态库中每个符号的位置和访问权限，而重定位将调整符号的地址，以便它们正确地映射到进程的内存空间中。
3. **初始化**：在符号解析和重定位之后，动态库的初始化代码将被执行。这是为了执行动态库中的初始化函数，进行必要的初始化工作，如设置全局变量、分配资源等。初始化代码可以根据需要在加载时执行，也可以延迟到首次调用库函数时执行。
4. **建立符号表和链接**：进程会建立一个符号表，用于记录动态库中的符号和对应的地址。符号表使得进程能够在运行时正确地解析动态库中的函数和变量。此外，进程还会建立动态库之间的链接关系，以便在需要的时候进行符号共享和调用。

一旦动态库加载和初始化完成，进程就可以使用该动态库中定义的函数和变量。进程可以通过符号表中的地址进行函数调用，也可以直接访问库中的全局变量。动态库的函数和变量在进程的内存空间中与其他代码和数据共享，可以被进程的其他部分或其他进程调用。

需要注意的是，每个进程在加载动态库时都会有自己独立的内存空间和上下文，因此动态库中的全局变量等状态是各个进程独立的。动态库中的线程安全性和并发性需要由动态库自身来保证，以避免多个进程间的竞态条件和数据争用。